{% extends 'base.html' %}

{% block title %}{{ store_owner.store_name }}{% endblock %}

{% block content %}
<h1 style="color: #333;">{{ store_owner.store_name }}</h1>
<p style="font-size: 18px;">Discover curated premium products</p>

{% if user == store_owner %}
    <h2 style="color: #444;">Your Products</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <tr style="background-color: #f4f4f4;">
            <th style="padding: 10px; text-align: left;">Name</th>
            <th style="padding: 10px; text-align: left;">Price</th>
            <th style="padding: 10px; text-align: left;">Quantity Sold</th>
        </tr>
        {% for product in products %}
        <tr>
            <td style="padding: 10px; border-bottom: 1px solid #ddd;">{{ product.name }}</td>
            <td style="padding: 10px; border-bottom: 1px solid #ddd;">${{ product.price }}</td>
            <td style="padding: 10px; border-bottom: 1px solid #ddd;">{{ product.order_set.count }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2 style="color: #444; margin-top: 30px;">Orders</h2>
    <ul style="list-style-type: none; padding: 0;">
    {% for order in orders %}
        <li style="margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border-radius: 5px;">
            {{ order.product.name }} - Quantity: {{ order.quantity }} - Buyer: {{ order.buyer_name }}
        </li>
    {% endfor %}
    </ul>
{% else %}
    <h2 style="color: #444;">Products</h2>
    <div style="display: flex; flex-wrap: wrap; justify-content: space-between;">
    {% for product in products %}
    <div style="width: 30%; margin-bottom: 20px; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
        <img src="{{ product.image.url }}" alt="{{ product.name }}" style="width: 100%; height: auto;">
        <h3>{{ product.name }}</h3>
        <p>${{ product.price }}</p>
        <button onclick="buyProduct('{{ product.product_id }}')" style="background: #e8491d; color: #fff; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;">Buy Now</button>
    </div>
    {% endfor %}
    </div>
{% endif %}

<script>
function buyProduct(productId) {
    var buyerName = prompt("Please enter your name:");
    var buyerPhone = prompt("Please enter your phone number:");
    
    if (buyerName && buyerPhone) {
        fetch('/order/create/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: `product_id=${productId}&buyer_name=${buyerName}&buyer_phone=${buyerPhone}`
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    }
}
</script>
{% endblock %}